
; /* Start:"a:4:{s:4:"full";s:88:"/local/templates/main/components/bitrix/form.result.new/ratings/script.js?16118241921910";s:6:"source";s:73:"/local/templates/main/components/bitrix/form.result.new/ratings/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
var check_recap = false;

function validate_form(show_msg = false){
	var starsCnt = $(".starrating2 input:checked").length;

	if(starsCnt <= 0){
		if(show_msg) alert("Пожалуйста, поставьте оценку.");
		return false;
	}

	if(!check_recap && $("#ratingQuizComment .g-recaptcha").length > 0) {
		if(show_msg) alert("Пожалуйста, подтвердите, что вы не робот.");
		return false;
	}

	$("#ratingQuizSubmit").removeClass("disabled");
	return true;
}


function onCaptchaComplete() {
	check_recap = true;
	validate_form();
}

function onCaptchaExpired() {
	check_recap = false;
	//alert("Срок действия каптчи истек! Поставьте галочку возле текста \"Я не робот\"");
	$("#ratingQuizSubmit").addClass("disabled");
	grecaptcha.reset();
}
$(document).ready(function(){
	//var gCaptchaChecked = grecaptcha && grecaptcha.getResponse().length > 0;

	$("#ratingQuizSubmit").on("click", function(){
		form = $(this).parents("form");
		if(validate_form(true)) {
			//отправляем на сервер
			$('#ratingQuizBlock').append('<div class="loading"></div>');
			$.post("/local/ajax/ajax_form.php", form.serialize(), function(data) {
				res = $.parseJSON(data);
				if(res.success) {
					//вывести пользователю какое-то сообщение
					$("#ratingQuizThanks").show();
					$('#rateWithStars, #ratingQuizComment, #ratingQuizSubmit').hide();

					document.cookie = "resvote" + $("#res_id", form).val() + "=Y;path="+ $("#res_url", form).val();
				} else {
					//сообщения о неудачной отправке
					alert(res.mess);
				}
				$(".loading").remove();
				$("html, body").animate({ scrollTop: $('#ratingQuizBlock').offset().top }, 1000);
			});

		}

		return false;
	});

	$(".starrating2").on("click", function(){
		validate_form();
	})

})


/* End */
;; /* /local/templates/main/components/bitrix/form.result.new/ratings/script.js?16118241921910*/
